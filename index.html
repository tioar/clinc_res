<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>è¨ºæ‰€é ç´„ç³»çµ±</title>
  <style>
    body {
      font-family: sans-serif;
      max-width: 500px;
      margin: 2em auto;
      padding: 1em;
      background-color: #f8f8f8;
      border-radius: 10px;
      box-shadow: 0 0 10px #ccc;
    }
    label, select, input {
      display: block;
      width: 100%;
      margin-top: 1em;
      padding: 0.5em;
      font-size: 1em;
    }
    button {
      margin-top: 1.5em;
      padding: 0.75em;
      background-color: #28a745;
      color: white;
      border: none;
      font-size: 1em;
      cursor: pointer;
    }
    #result {
      margin-top: 1.5em;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h2>è¨ºæ‰€é ç´„è¡¨å–®</h2>
  <form id="reservationForm">
    <label>é ç´„æ—¥æœŸï¼š<input type="date" id="date" name="date" required /></label>
    <label>è¨ºåˆ¥ï¼š
      <select id="session" name="session" required>
        <option value="æ—©ä¸Šè¨º">æ—©ä¸Šè¨º</option>
        <option value="ä¸‹åˆè¨º">ä¸‹åˆè¨º</option>
        <option value="æ™šä¸Šè¨º">æ™šä¸Šè¨º</option>
      </select>
    </label>
    <label>åˆè¨ºæˆ–è¤‡è¨ºï¼š
      <select id="visitType" name="visitType" required>
        <option value="åˆè¨º">åˆè¨º</option>
        <option value="è¤‡è¨º">è¤‡è¨º</option>
      </select>
    </label>
    <label>å§“åï¼š<input type="text" id="name" name="name" required /></label>
    <label>å‡ºç”Ÿå¹´æœˆæ—¥ï¼š<input type="date" id="birthday" name="birthday" required /></label>
    <label>èº«åˆ†è­‰å­—è™Ÿï¼ˆåˆè¨ºå¿…å¡«ï¼‰ï¼š<input type="text" id="idNumber" name="idNumber" /></label>
    <label>é€£çµ¡é›»è©±ï¼š<input type="tel" id="phone" name="phone" required /></label>
    <button type="submit">é€å‡ºé ç´„</button>
  </form>
  <div id="result"></div>
  <script>
    const form = document.getElementById('reservationForm');
    const result = document.getElementById('result');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      const formData = new FormData(form);
      const data = Object.fromEntries(formData.entries());

      // èº«åˆ†è­‰é©—è­‰ï¼ˆåˆè¨ºå¿…å¡«ï¼‰
      if (data.visitType === 'åˆè¨º' && !data.idNumber.trim()) {
        alert('åˆè¨ºè€…è«‹å¡«å¯«èº«åˆ†è­‰å­—è™Ÿ');
        return;
      }

      const today = new Date();
      const selectedDate = new Date(data.date);
      const maxDate = new Date();
      maxDate.setDate(today.getDate() + 14);

      if (selectedDate < today || selectedDate > maxDate) {
        alert('åƒ…èƒ½é ç´„æœªä¾† 14 å¤©å…§çš„æ—¥æœŸ');
        return;
      }

      try {
        const response = await fetch('https://script.google.com/macros/s/AKfycbyMFaIoEaHtOqP1Qo6dSQ1MQV4Gs9oN3EPwBx0AjFYUJeCBU55puNx6VmwEmzE_dKEB/exec', {
          method: 'POST',
          body: JSON.stringify(data),
          headers: {
            'Content-Type': 'application/json'
          }
        });
        const res = await response.json();
        if (res.success) {
          result.innerHTML = `<p style="color:green">é ç´„æˆåŠŸï¼æ‚¨çš„è™Ÿç¢¼æ˜¯ ${res.number} è™Ÿ</p>
          <p><a href="https://line.me/R/ti/p/@xxxxx">ğŸ”™ è¿”å›å®˜æ–¹ LINE</a></p>`;
          form.reset();
        } else {
          throw new Error(res.message);
        }
      } catch (err) {
        result.innerHTML = `<p style="color:red">é ç´„å¤±æ•—ï¼š${err.message}</p>`;
      }
    });
